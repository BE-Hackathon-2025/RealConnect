<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>The Real Connect – Find Wellness & Community Resources</title>
        <link rel="stylesheet" href="styles.css">
        <script>
           window.addEventListener("DOMContentLoaded", async () => {
            const savedMessage = sessionStorage.getItem("message");
            if (!savedMessage) return;
            appendMessage(savedMessage, "user");
            sessionStorage.removeItem("message");

            const subBtn = document.getElementById("chatbot-submit");
            subBtn.disabled = true;

            const fallback = findResourceReply(savedMessage);
            const history = [
                { role: "system", content: "You are a helpful, concise assistant connecting people to verified, factual resources for their problems and issues." },
                { role: "user", content: savedMessage }
            ];

            try {
                const res = await fetch("/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ messages: history }),
                });

                if (!res.ok) throw new Error("Network Error");

                const data = await res.json();
                console.log("API Response (redir):", data);

                const reply = data.reply || fallback || "(no response)";
                appendMessage(reply, "bot");
            } catch (err) {
                console.error(err);
                appendMessage(err.message, "bot");
            } finally {
                subBtn.disabled = false;
            }
            });
        </script>
    </head>
    <body>
        <nav class="navbar">
            <div class="navbar-logo">The Real Connect</div>
            <ul class="navbar-links">
                <li><a href="#wellness">Wellness</a></li>
                <li><a href="#essentials">Essentials</a></li>
                <li><a href="#work">Work & Growth</a></li>
                <li><a href="#learn">Learn & Level Up</a></li>
                <li><a href="communitywall.html">Community Wall</a></li>
            </ul>
        </nav>
        <div id="chatbot-container" class="chatbot-container">
            <div class="chatbot-header">
                <span>RealConnect Bot</span>
            </div>
            <div id="chatbot-messages" class="chatbot-messages"></div>
            <form id="chatbot-form" class="chatbot-form" onsubmit="handleChat(event)">
            <input type="text" id="chatbot-input" placeholder="Ask for resources…" autocomplete="off" required>
            <button id="chatbot-submit" type="submit">Send</button>
            </form>
        </div>
        
        <script src="chatbot.js"></script>
        
    </body>
</html>